defmodule CraftbeerUi.Display do

    alias Circuits.I2C

    def init() do
        {:ok, ref} = I2C.open("i2c-1")
        res = I2C.write(ref, 0x3f, <<8,12,8,56,60,56,8,12,8,56,60,56,8,12,8,56,60,56,8,12,8,40,44,40,40,44,40,136,140,136,8,12,8,200,204,200,8,12,8,24,28,24,8,12,8,104,108,104>>)
        case res do
            :ok -> IO.puts("Ok")
            _ -> IO.puts("Error")
        end

        {:ok, ref}
    end

    def close(ref) do
        I2C.close(ref)
    end

    def writeLine(ref, line, text) do
        
        display = lines(line) <> Enum.reduce(text, <<>>, fn(x, acc) -> acc <> convertChar(x) end)
        I2C.write(ref, 0x3f, display)
    end

    def clear(ref) do
        I2C.write(ref, 0x3f, <<136,140,136,8,12,8,57,61,57,153,157,153,8,12,8,24,28,24,8,12,8,40,44,40>>)
    end

    defp lines(line) do 
        case line do
            1 -> <<136,140,136,8,12,8>>
            2 -> <<200,204,200,8,12,8>>
            _ -> <<136,140,136,8,12,8>>
        end
    end


    defp convertChar(char) do

        case char  do
            46 ->  <<41,45,41,233,237,233>>
            47 ->  <<41,45,41,249,253,249>>
            48 ->  <<57,61,57,9,13,9>>
            49 ->  <<57,61,57,25,29,25>>
            50 ->  <<57,61,57,41,45,41>>
            51 ->  <<57,61,57,57,61,57>>
            52 ->  <<57,61,57,73,77,73>>
            53 ->  <<57,61,57,89,93,89>>
            54 ->  <<57,61,57,105,109,105>>
            55 ->  <<57,61,57,121,125,121>>
            56 ->  <<57,61,57,137,141,137>>
            57 ->  <<57,61,57,153,157,153>>

            65 ->  <<73,77,73,25,29,25>>
            66 ->  <<73,77,73,41,45,41>>
            67 ->  <<73,77,73,57,61,57>>
            68 ->  <<73,77,73,73,77,73>>
            69 ->  <<73,77,73,89,93,89>>
            70 ->  <<73,77,73,105,109,105>>
            71 ->  <<73,77,73,121,125,121>>
            72 ->  <<73,77,73,137,141,137>>
            73 ->  <<73,77,73,153,157,153>>
            74 ->  <<73,77,73,169,173,169>>
            75 ->  <<73,77,73,185,189,185>>
            76 ->  <<73,77,73,201,205,201>>
            77 ->  <<73,77,73,217,221,217>>
            78 ->  <<73,77,73,233,237,233>>
            79 ->  <<73,77,73,249,253,249>>
            80 ->  <<89,93,89,9,13,9>>
            81 ->  <<89,93,89,25,29,25>>
            82 ->  <<89,93,89,41,45,41>>
            83 ->  <<89,93,89,57,61,57>>
            84 ->  <<89,93,89,73,77,73>>
            85 ->  <<89,93,89,89,93,89>>
            86 ->  <<89,93,89,105,109,105>>
            87 ->  <<89,93,89,121,125,121>>
            88 ->  <<89,93,89,137,141,137>>
            89 ->  <<89,93,89,153,157,153>>
            90 ->  <<89,93,89,169,173,169>>
            32 ->  <<41,45,41,9,13,9>>

            97 ->  <<105,109,105,25,29,25>>
            98 ->  <<105,109,105,41,45,41>>
            99 ->  <<105,109,105,57,61,57>>
            100 ->  <<105,109,105,73,77,73>>
            101 ->  <<105,109,105,89,93,89>>
            102 ->  <<105,109,105,105,109,105>>
            103 ->  <<105,109,105,121,125,121>>
            104 ->  <<105,109,105,137,141,137>>
            105 ->  <<105,109,105,153,157,153>>
            106 ->  <<105,109,105,169,173,169>>
            107 ->  <<105,109,105,185,189,185>>
            108 ->  <<105,109,105,201,205,201>>
            109 ->  <<105,109,105,217,221,217>>
            110 ->  <<105,109,105,233,237,233>>
            111 ->  <<105,109,105,249,253,249>>
            112 ->  <<121,125,121,9,13,9>>
            113 ->  <<121,125,121,25,29,25>>
            114 ->  <<121,125,121,41,45,41>>
            115 ->  <<121,125,121,57,61,57>>
            116 ->  <<121,125,121,73,77,73>>
            117 ->  <<121,125,121,89,93,89>>
            118 ->  <<121,125,121,105,109,105>>
            119 ->  <<121,125,121,121,125,121>>
            120 ->  <<121,125,121,137,141,137>>
            121 ->  <<121,125,121,153,157,153>>
            122 ->  <<121,125,121,169,173,169>>

            _ -> <<41,45,41,9,13,9>>
        end
    end

end